## Core Node JS course work
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/Notebook-4.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/Notebook-5.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/Notebook-6.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/Notebook-7.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/Notebook-8.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/Notebook-9.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/Notebook-10.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/Notebook-11.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/Notebook-12.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/19.01.2018/Notebook-1.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/19.01.2018/Notebook-2.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/19.01.2018/Notebook-3.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/19.01.2018/Notebook-4.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/19.01.2018/Notebook-5.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/22.01.2018/Notebook-1.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/22.01.2018/Notebook-2.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/22.01.2018/Notebook-3.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/22.01.2018/Notebook-4.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/22.01.2018/Notebook-5.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/22.01.2018/Notebook-6.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/22.01.2018/Notebook-7.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/22.01.2018/Notebook-8.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/22.01.2018/Notebook-9.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/22.01.2018/Notebook-10.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/01/svg_files/22.01.2018/Notebook-11.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/05/svg_files/Notebook-22.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/05/svg_files/Notebook-23.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/05/svg_files/Notebook-24.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/05/svg_files/Notebook-25.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/05/svg_files/Notebook-26.svg" width="80%" height="80%">
</a>

## Global Objects, Process, and Buffer

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/06/svg_files/Notebook-27.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/06/svg_files/Notebook-28.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/06/svg_files/Notebook-29.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/06/svg_files/Notebook-30.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/06/svg_files/Notebook-37.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/06/svg_files/Notebook-38.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/06/svg_files/Notebook-39.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/06/svg_files/Notebook-40.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/06/svg_files/Notebook-42.svg" width="80%" height="80%">
</a>

```js

const { StringDecoder } = require('string_decoder');
const decoder = new StringDecoder('utf8');

process.stdn.on('readable', () => {
  const chunk = process.stdn.read();
  if (chunk != null ) {
    const buffer = Buffer.from([chunk]);
    console.log('with .toString function:', buffer.toString());
    console.log('With StringDecoder: function', decoder.write(buffer));
  }
});

```
## Require() function and 'stuff' about modules

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/07/svg_files/Notebook-43.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/07/svg_files/Notebook-44.svg" width="80%" height="80%">
</a>

```
$ node
> console.log(module);
{ id: 'repl',
  exports:
   { writer: { [Function: inspect] colors: [Object], styles: [Object] },
     _builtinLibs:
      [ 'assert',
        'buffer',
        'child_process',
        'cluster',
        'crypto',
        'dgram',
        'dns',
        'domain',
        'events',
        'fs',
        'http',
        'https',
        'net',
        'os',
        'path',
        'punycode',
        'querystring',
        'readline',
        'stream',
        'string_decoder',
        'tls',
        'tty',
        'url',
        'util',
        'vm',
        'zlib',
        'smalloc' ],
     REPLServer: { [Function: REPLServer] super_: [Object] },
     start: [Function],
     repl:
      { _domain: [Object],
        useGlobal: true,
        ignoreUndefined: false,
        rli: [Circular],
        eval: [Object],
        inputStream: [Object],
        outputStream: [Object],
        lines: [Object],
        context: [Object],
        _events: [Object],
        bufferedCommand: '',
        _sawReturn: true,
        domain: null,
        _maxListeners: undefined,
        output: [Object],
        input: [Object],
        completer: [Function: complete],
        _initialPrompt: '> ',
        _prompt: '> ',
        terminal: true,
        line: '',
        cursor: 0,
        history: [Object],
        historyIndex: -1,
        commands: [Object],
        writer: [Function],
        useColors: true,
        prevRows: 0 } },
  parent: undefined,
  filename: 'C:\\git\\NodeJS\\coreNode\\07\\repl',
  loaded: false,
  children: [],
  paths:
   [ 'C:\\git\\NodeJS\\coreNode\\07\\repl\\node_modules',
     'C:\\git\\NodeJS\\coreNode\\07\\node_modules',
     'C:\\git\\NodeJS\\coreNode\\node_modules',
     'C:\\git\\NodeJS\\node_modules',
     'C:\\git\\node_modules',
     'C:\\node_modules' ] }
undefined

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/07/svg_files/Notebook-45.svg" width="80%" height="80%">
</a>

## Addons

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/08/svg_files/Notebook-46.svg" width="80%" height="80%">
</a>

```javascript
require.extensions
{ '.js': [Function],
  '.json': [Function],
  '.node': [Function: dlopen] }

```

```cpp
// hello.cc edited by Stan Alam taken from https://nodejs.org/api/addons.html
#include <node.h>

namespace demo {

using v8::FunctionCallbackInfo;
using v8::Isolate;
using v8::Local;
using v8::Object;
using v8::String;
using v8::Value;

void Method(const FunctionCallbackInfo<Value>& args) {
  Isolate* isolate = args.GetIsolate();
  args.GetReturnValue().Set(String::NewFromUtf8(isolate, "Multiverse(s)"));
}

void init(Local<Object> exports) {
  NODE_SET_METHOD(exports, "hello", Method);
}

NODE_MODULE(NODE_GYP_MODULE_NAME, init)

}  // namespace demo
```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/08/svg_files/Notebook-47.svg" width="80%" height="80%">
</a>

```
> require.extensions['.json'].toString()
'function (module, filename) {\n  var content = fs.readFileSync(filename, \'utf8
\');\n  try {\n    module.exports = JSON.parse(stripBOM(content));\n  } catch (e
rr) {\n    err.message = filename + \': \' + err.message;\n    throw err;\n  }\n
}'
> require.extensions['.node'].toString()
'function dlopen() { [native code] }'
>

```
## Wrapping, Caching modules

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/09/svg_files/Notebook-48.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/09/svg_files/Notebook-49.svg" width="80%" height="80%">
</a>

```
> require('module').wrapper
[ '(function (exports, require, module, __filename, __dirname) { ',
  '\n});' ]
>

```

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/09/svg_files/Notebook-49.5.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/09/svg_files/Notebook-50.svg" width="80%" height="80%">
</a>

```javascript

const print = (stars, header) => {
  console.log('*'.repeat(stars));
  console.log(header);
  console.log('*'.repeat(stars));
};
// node >= 8
// or use harmony flag
```

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/09/svg_files/Notebook-51.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/09/svg_files/Notebook-52.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/svg_files/Notebook-53.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/svg_files/Notebook-54.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/svg_files/Notebook-62.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/svg_files/Notebook-63.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/svg_files/Notebook-64.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/svg_files/Notebook-65.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/svg_files/Notebook-66.svg" width="80%" height="80%">
</a>

# Concurrency Model and Event Loop

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/12/svg_files/Notebook-67.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/12/svg_files/Notebook-68.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/13-14/svg_files/Notebook-69.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/13-14/svg_files/Notebook-70.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/13-14/svg_files/Notebook-71.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-73.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-74.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-75.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-76.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-77.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-78.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-79.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-80.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-81.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-82.svg" width="80%" height="80%">
</a>

```js
const fs = require('fs');

fs.readFile(__filename, () => {
  setTimeout() => {
   console.log('execute timeout');
 }, 0); //set timeout is at 0 milliseconds
  setImmediate(() => {
    console.log('execute setImmediate');
  });
});
/*
$ node setImmediate.js
execute setImmediate
execute setTimeout
$
*/
```

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-83.svg" width="80%" height="80%">
</a>

```js

const fs = require('fs');

function fileSize (fileName, mycallBack) {
  if (typeof fileName !== 'string') {
    return mycallBack(new TypeError('argument should have been a string'));
  }

  fs.stat(fileName, (err, stats) => {
    if(err) {
      return mycallBack(err);
    }

    mycallBack(null, stats.size);
  });
}

fileSize(__filename, (err, size) => {
  if (err) throw err;

  console.log(`Size in KB: ${size/1024}`);
});

console.log('Hello, Multiverse!');

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-84.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-87.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-88.svg" width="80%" height="80%">
</a>

```js

const fs = require('fs');

const readFileAsArray = function(file, callback) {
    fs.readFile(file, function(err, data) {
        if (err) {
            return callback(error);
        }

        const lines = data.toString().trim().split('\n');
        callback(null, lines);
    });
};

readFileAsArray('./numbers', (err, lines) => {
    if (err) throw err;

    const numbers = lines.map(Number);
    const oddNumbers = numbers.filter(number => number % 2 === 1);
    console.log('odd number count is : ', oddNumbers.length);
});

```

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-91.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-92.svg" width="80%" height="80%">
</a>

```js

const fs = require('fs');

const readFileAsArray = function(file) {
  return new Promise((resolve, reject) => {
    fs.readFile(file, function(err, data) {
      if(err) {
        return reject(err);
      }

      const lines = data.toString().trim().split('\n');
      resolve(lines);
    });
  });
};

// here's where you make the call
readFileAsArray('./numbers').then(lines => {
  const numbers = lines.map(Number);
  const oddNumbers = numbers.filter(number => number % 2 === 1);
  console.log('odd numbers count:', oddNumbers.length);
})
.catch(console.error);

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-93.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-94.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-95.svg" width="80%" height="80%">
</a>

```js

const fs = require('fs');

const readFileAsArray = function(file, callback = () => {}) { //notice the empty function
  return new Promise((resolve, reject) => {
    fs.readFile(file, function(err, data) {
      if(err) {
        reject(err);
        return callback(err); // you can see you're still returning, this time with a callback
      }

      const lines = data.toString().trim().split('\n');
      resolve(lines);
      callback(null, lines);
    });
  });
};

// here's where you make the call
readFileAsArray('./numbers').then(lines => {
  const numbers = lines.map(Number);
  const oddNumbers = numbers.filter(number => number % 2 === 1);
  console.log('odd numbers count:', oddNumbers.length);
})
.catch(console.error);

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-96.svg" width="80%" height="80%">
</a>

```js

async function countEven() {
//  (%) is the modulus operator, it will let you have the remainder of place/sequence.length. taken from stackoverflow
try {
  const lines = await readFileAsArray('./numbers');
  const numbers = lines.map(Number);
  const evenCount = numbers.filter(number => number % 2 !== 1).length
  console.log('even number count is : ', evenCount);
} catch(err) {
  console.error(err);
}
  }
}

countEven(); // wow! async code running synchronously ... good for test automation!

```

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-98.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-99.svg" width="80%" height="80%">
</a>

```js
//sync_event.js
const EventEmitter = require('events');

class Logger extends EventEmitter {
  execute(theTask) {
    console.log('State before execution');
    this.emit('Begin');
    theTask();
    this.emit('fin');
    console.log('State after execution');
  }
}

const logger = new Logger();

logger.on('begin', () => console.log('About to execute'));
logger.on('end', () => console.log('Done with executing'));

logger.execute(() => console.log('***** execute task ******* '));

```
### Shell Output

```
$ node sync_event.js
State before execution
***** execute task *******
State after execution

```
**Notice that the execution of sync_event.js is synchronous.**

```js

//sync_event2.js
const EventEmitter = require('events');

class Logger extends EventEmitter {
  execute(theTask) {
    console.log('State before execution');
    this.emit('Begin');
    theTask();
    this.emit('fin');
    console.log('State after execution');
  }
}

const logger = new Logger();

logger.on('begin', () => console.log('About to execute'));
logger.on('end', () => console.log('Done with executing'));

logger.execute(() => setTimeout(
  () => console.log('***** execute task ******* '),
  1000
  )
);

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-100.svg" width="80%" height="80%">
</a>

```js
const fs = require('fs');
const EventEmitter = require('events');

class ElapsedTime extends EventEmitter {
execute(asyncFunc, ...args) {
  console.time('execute');
  this.emit('begin');
  asyncFunc(...args, (err, data) => {
    if(err) {
      return this.emit('error', err);
    }

    this.emit('data', data);
    console.timeEnd('execute');
    this.emit('end');
  });
  }
}

const elapsedTime = new ElapsedTime();

elapsedTime.on('begin', () => console.log('ready to exec'));
elapsedTime.on('end', () => console.log('completed execution'));

elapsedTime.execute(fs.readFile, __filename);

```
### Shell Output
```
$ node async_event.js
ready to exec
execute: 47.151ms
completed execution

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-101.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-102.svg" width="80%" height="80%">
</a>

```js

const fs = require('fs');
const EventEmitter = require('events');

class ElapsedTime extends EventEmitter {
execute(asyncFunc, ...args) {
  console.time('execute');
  this.emit('begin');
  asyncFunc(...args, (err, data) => {
    if(err) {
      return this.emit('error', err);
    }

    this.emit('data', data);
    console.timeEnd('execute');
    this.emit('end');
  });
  }
}

const elapsedTime = new ElapsedTime();

elapsedTime.on('data', (data) => {
  console.log(`Length: ${data.length}`);
});
elapsedTime.execute(fs.readFile, __filename);

```

### Shell Output

```
$ node async_event2.js
Length: 571
execute: 3.550ms

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-103.svg" width="80%" height="80%">
</a>

```js

const fs = require('fs');
const EventEmitter = require('events');

class ElapsedTime extends EventEmitter {
execute(asyncFunc, ...args) {
  console.time('execute');
  this.emit('begin');
  asyncFunc(...args, (err, data) => {
    if(err) {
      return this.emit('error', err);
    }

    this.emit('data', data);
    console.timeEnd('execute');
    this.emit('end');
  });
  }
}

const elapsedTime = new ElapsedTime();

elapsedTime.on('data', (data) => {
  console.log(`Length: ${data.length}`);
});

elapsedTime.execute(fs.readFile, ''); //notice blank in argument, will crash
elapsedTime.execute(fs.readFile, __filename);

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-104.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-105.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-106.svg" width="80%" height="80%">
</a>

```javascript
const EventEmitter = require('events');

class Server extends EventEmitter {
  constructor(client) { //define the constructor to receive the client *within the server class
    super();  
  }
}
//created a function not just an object
module.exports = (client) => new Server(client); // Server(client) instantiate the server object with the client object
//the function (client) is going to receive the client

```

```javascript
//client
const EventEmitter = require('events');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin, output:process.stdout
});

//client event emmiter
const client = new EventEmitter(); //instantiate an object directly from EventEmitter
const server = require('./server')(client); //import server object
/* the client is going to emit events, while
the server is going to listen to those events
*/

rl.on('line', (input) => { //here register a listener for the line event, that receives an input

});

```

```js
//client with latest update to read input from cli and echo input with readline.process.stdout
const EventEmitter = require('events');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

//client event emmiter
const client = new EventEmitter(); //instantiate an object directly from EventEmitter
const server = require('./server')(client); //import server object, also export a FUNCTION with the client as an arg
/* the client is going to emit events, while
the server is going to listen to those events
*/
//use the readline interInterface
rl.on('line', (input) => { //here register a listener for the line event, that receives an input
  console.log(input); //log the inpout line, to test the client
});

```

```
//output  
$ node client.js
yo
yo

```

```js

const EventEmitter = require('events');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

//client event emmiter
const client = new EventEmitter(); //instantiate an object directly from EventEmitter
const server = require('./server')(client); //import server object
/* the client is going to emit events, while
the server is going to listen to those events
*/
//use the readline interInterface
rl.on('line', (input) => { //here register a listener for the line event, that receives an input
  client.emit('command', input);  // now everytime the user presses ENTER,
}); // the client is going to emit an input EVENT to the server


```

**The idea is to enter a value such as 'help' which is the command value and the Server will read and respond accordingly.**

```js
// client is able to clear the terminal when a command is entered
// client echos the command, and the correct command too. from the server
const EventEmitter = require('events');
const readline = require('readline');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

//client event emmiter
const client = new EventEmitter(); //instantiate an object directly from EventEmitter
const server = require('./server')(client); //import server object
/* the client is going to emit events, while
the server is going to listen to those events
*/
server.on('response', (resp) => { //when the server emits a response event, the listener will access the response as a function
  //console.log(`Response: ${resp}`);
  process.stdout.write('\u001B[2J\u001B[0;0f'); //clear terminal
  process.stdout.write(resp);
  process.stdout.write('\n\>');
});
//use the readline interInterface
rl.on('line', (input) => { //here register a listener for the line event, that receives an input
  client.emit('command', input);  // now everytime the user presses ENTER,
});  // the client is going to emit an input EVENT to the server

```
### Server is able to take four commands and echo invalid commands

```js
//server is able to handle four commands, and update accordingly, also can handle invalid commands
const EventEmitter = require('events');

class Server extends EventEmitter {
  constructor(client) { //define the constructor to receive the client *within the server class
    super();
    client.on('command', (command) => {
      console.log(`Command: ${command}`);
      switch(command) {
        case 'help':
        case 'add':
        case 'del':
        case 'ls':
        this[command]();
        break;
      default: // case in which is unknown command
        this.emit('response', 'unknown command:' + `${command}`);
      }
      // help, add, del, ls
    });
  }
    help() { //create an instance method for each command
      this.emit('response', 'help is on the way ...');
    }
    add() {
      this.emit('response', 'adding ...');
      }
   del() {
     this.emit('response', 'deleting ...');
   }
   ls(){
     this.emit('response', 'ls-Ing...');
   }
}
//created a function not just an object
module.exports = (client) => new Server(client); // Server(client) instantiate the server object with the client object
//the function (client) is going to receive the client

```

```text  
//terminal output
$ node client.js
help is on the way ...
>

```
## Server

```js
//complete server.js
const EventEmitter = require('events');

class Server extends EventEmitter {
    constructor(client) { //define the constructor to receive the client *within the server class
        super();
        //this.emit('response', 'Welcome -- enter a command or help for list of commands'); // THIS IS NOT WORKING!
        /* this.emit does not work because it will be executed when
        const server = require(./server)(client) in client.js will be executed
         This is the sequential order, so the handler of the reponse event is not being defined at execution time
         */
        this.tasks = {}; //task object to hold task info
        this.taskId = 1; //task Id to keep track of number tasks starting at 1, counter holder for new tasks
        process.nextTick(() => {
            this.emit('response', 'Welcome - type a command or enter help for list of valid command options');
        });
        client.on('command', (command, args) => { //now server can accept a command and an array of arguments
            console.log(`Command: ${command}`);
            switch (command) {
                case 'help':
                case 'add':
                case 'del':
                case 'ls':
                    this[command](args); // NOW THE ARRAY OF ARGS CAN BE PASSED TO EVERY COMMAND TO BE EXECUTED.
                    break;
                default: // case in which is unknown command
                    this.emit('response', 'unknown command: ' + `${command}`);
            }
            // help, add, del, ls
        });
    }

    tasksString() {
      return Object.keys(this.tasks).map(key => { //loop over key, return task, for every key return string to ls
        return `${key}: ${this.tasks[key]}`;
      }).join('\n');
    }

    help() { //create an instance method for each command
        this.emit('response', `Available commands:
        add, del {id}, ls`);
    }
    add(args) {
        this.tasks[this.taskId] = args.join(' ');  // each task is now added to task object
        this.emit('response', `Added task ${this.taskId}`); //emit the number of the task to user
        this.taskId++;
    }
    del() {
       delete(this.tasks[args[0]]); //for deleting the task, delete the id indicated by user
       this.emit('response', `Deleting task ${args[0]}`); //print to console task has been deleted
    }
    ls() {
        this.emit('response', `List of Tasks\n${this.tasksString()}`);
    }
}
//created a function not just an object
module.exports = (client) => new Server(client); // Server(client) instantiate the server object with the client object
//the function (client) is going to receive the client
```

## Client

```js
//complete client
const EventEmitter = require('events');
const readline = require('readline');

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

//client event emmiter
const client = new EventEmitter(); //instantiate an object directly from EventEmitter
const server = require('./server')(client); //import server object
/* the client is going to emit events, while
the server is going to listen to those events
*/
server.on('response', (resp) => { //when the server emits a response event, the listener will access the response as a function
    //console.log(`Response: ${resp}`);
    process.stdout.write('\u001B[2J\u001B[0;0f'); //clear terminal
    process.stdout.write(resp);
    process.stdout.write('\n\>');
});
//use the readline interInterface
let command, args;
rl.on('line', (input) => { //here register a listener for the line event, that receives an input
  [command, ...args] = input.split(' '); //split on space, the first "token" will be on command, the rest will be passed in the arguments(args)
  client.emit('command', command, args); //pass both command and argument, it will be parsed at the first space after command
}); // the client is going to emit an input EVENT to the server
```
## Node Networking

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-7.svg" width="80%" height="80%">
</a>

```js
process.stdout.write('\u001B[2J\u001B[0;0f'); //again clear node terminal

const server = require('net').createServer(); // here use the createServer method from net module

server.on('connection', socket => {
  console.log('Client is connected!');
  socket.write('Welcome!');
});

server.listen(3000, () => console.log('I am Server'));
```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-8.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-9.svg" width="80%" height="80%">
</a>

```js
process.stdout.write('\u001B[2J\u001B[0;0f'); //again clear node terminal

const server = require('net').createServer(); // here use the createServer method from net module

server.on('connection', socket => {
  console.log('Client is connected!');
  socket.write('Welcome!\n');

  socket.on('data', data => {
    console.log('data is', data);
    socket.write('data is ');
    socket.write(data);
  });

  socket.on('end', () => {
    console.log('Client is now disconnected');
  });
});

server.listen(3000, () => console.log('I am Server'));
```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-10.svg" width="80%" height="80%">
</a>

```js
process.stdout.write('\u001B[2J\u001B[0;0f'); //again clear node terminal
let counter = 0;
const server = require('net').createServer(); // here use the createServer method from net module

server.on('connection', socket => {
  socket.id = counter++; //everytime a client connects assign an id, and add to the counter for next socket Id
  console.log('Client is connected!');
  socket.write('Welcome!\n');

  socket.on('data', data => {
    socket.write(`${socket.id}: `);
    console.log('data is', data);
    socket.write('data is ');
    socket.write(data);
  });

  socket.on('end', () => {
    console.log('Client is now disconnected');
  });
});

server.listen(3000, () => console.log('I am Server'));
// use tmux to connect with multiple clients -- i.e. fingers should
//never leave the keyboard!
```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-11.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-12.svg" width="80%" height="80%">
</a>

```js
process.stdout.write('\u001B[2J\u001B[0;0f'); //again clear node terminal
const server = require('net').createServer(); // here use the createServer method from net module
let counter = 0;
let sockets = {};

server.on('connection', socket => {
  socket.id = counter++; //everytime a client connects assign an id, and add to the counter for next socket Id
  sockets[sockets.id] = socket;

  console.log('Client is connected!');
  socket.write('Welcome!\n');

  socket.on('data', data => {
   Object.entries(sockets).forEach(([, cs]) => {  //the empty value would be key, but there is none
    cs.write(`${socket.id}: `);
  //  console.log('data is', data);
    cs.write(data);
  });
});
  socket.on('end', () => {
    console.log('Client is now disconnected');
  });
});

server.listen(3000, () => console.log('I am Server'));
// use tmux to connect with multiple clients -- i.e. fingers should
//never leave the keyboard!
```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-13.svg" width="80%" height="80%">
</a>

```js
process.stdout.write('\u001B[2J\u001B[0;0f'); //again clear node terminal
const server = require('net').createServer(); // here use the createServer method from net module
let counter = 0;
let sockets = {};

server.on('connection', socket => {
  socket.id = counter++; //everytime a client connects assign an id, and add to the counter for next socket Id
  sockets[sockets.id] = socket;

  console.log('Client is connected!');
  socket.write('Welcome!\n');

  socket.on('data', data => {
   Object.entries(sockets).forEach(([key, cs]) => {  //the empty value would be key, but there is none
    if (socket.id == key)
      return;
    cs.write(`${socket.id}: `);
  //  console.log('data is', data);
    cs.write(data);
  });
});  

  socket.on('end', () => {
    delete sockets[socket.id];
    console.log('Client is now disconnected');
  });
});

server.listen(3000, () => console.log('I am Server'));
// use tmux to connect with multiple clients -- i.e. fingers should
//never leave the keyboard!
```

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-14.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-15.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-16.svg" width="80%" height="80%">
</a>

```js
const dgram = require('dgram');

const server = dgram.createSocket('udp4');

server.on('listening', () => console.log('UDP Server is listening up and listening!')); // listening event

server.on('message', (msg, rinfo) => { // register handle for message event, callback exposes message and -->
  console.log(`${rinfo.address}:${rinfo.port} - ${msg}`); // remote address and port
});

const PORT = 3333;
const HOST = '127.0.0.1'; //home
server.bind(PORT, HOST);

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-17.svg" width="80%" height="80%">
</a>

```js
const dgram = require('dgram');
const PORT = 3333;
const HOST = '127.0.0.1'; //home

//server
const server = dgram.createSocket('udp4');

server.on('listening', () => console.log('UDP Server is listening up and listening!')); // listening event

server.on('message', (msg, rinfo) => { // register handle for message event, callback exposes message and -->
  console.log(`${rinfo.address}:${rinfo.port} - ${msg}`); // remote address and port
});


server.bind(PORT, HOST);

//clients
setInterval(function () {
  const client = dgram.createSocket('udp4');

  client.send('Mozart is awesome!', PORT, HOST, (err) => {
    if (err) throw err;

    console.log('message sent by UDP');
    client.close();
  });
}, 1000); // 1 second interval
```
```
$ node stanUDP.js
UDP Server is up and listening!
message sent by UDP
127.0.0.1:61164 - Mozart is awesome!
message sent by UDP
127.0.0.1:52090 - Mozart is awesome!
message sent by UDP
127.0.0.1:52091 - Mozart is awesome!
message sent by UDP
127.0.0.1:52092 - Mozart is awesome!
```

### Here we're using sending a buffer instead of string

```js
const dgram = require('dgram');
const PORT = 3333;
const HOST = '127.0.0.1'; //home


//server
const server = dgram.createSocket('udp4');

server.on('listening', () => console.log('UDP Server is up and listening! ')); // listening event

server.on('message', (msg, rinfo) => { // register handle for message event, callback exposes message and -->
  console.log(`${rinfo.address}:${rinfo.port} - ${msg}`); // remote address and port
});


server.bind(PORT, HOST);

//clients
setInterval(function () {
  const client = dgram.createSocket('udp4');
  const msg = Buffer.from('Mozart ROCKS!!!')

  client.send(msg, 0, msg.length, PORT, HOST, (err) => {
    if (err) throw err;

    console.log('message sent by UDP');
    client.close();
  });
}, 1000);
```
### Output is the same
```
$ node stanUDPbuff.js
UDP Server is up and listening!
message sent by UDP
127.0.0.1:58048 - Mozart ROCKS!!!
message sent by UDP
127.0.0.1:58049 - Mozart ROCKS!!!
message sent by UDP
127.0.0.1:56642 - Mozart ROCKS!!!
message sent by UDP
127.0.0.1:56643 - Mozart ROCKS!!!
message sent by UDP
127.0.0.1:56644 - Mozart ROCKS!!!

```

### Here we specify an offset, you can even send an array of messages as 1st argument

```js

const dgram = require('dgram');
const PORT = 3333;
const HOST = '127.0.0.1'; //home


//server
const server = dgram.createSocket('udp4');

server.on('listening', () => console.log('UDP Server is up and listening!')); // listening event

server.on('message', (msg, rinfo) => { // register handle for message event, callback exposes message and -->
  console.log(`${rinfo.address}:${rinfo.port} - ${msg}`); // remote address and port
});


server.bind(PORT, HOST);

//clients
setInterval(function () {
  const client = dgram.createSocket('udp4');
  const msg = Buffer.from('Mozart ROCKS!!!')

  client.send(msg, 0, 7,  PORT, HOST, (err) => {
    if (err) throw err;

  client.send(msg, 7, 6, PORT, HOST, (err) => {
      if (err) throw err;

    console.log('message sent by UDP');
    client.close();
  });
});  
}, 1000);

```

```

UDP Server is up and listening!
message sent by UDP
127.0.0.1:51492 - Mozart
message sent by UDP
127.0.0.1:51494 - Mozart
127.0.0.1:51494 - ROCKS!
message sent by UDP
127.0.0.1:51495 - Mozart
127.0.0.1:51495 - ROCKS!

```

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-18.svg" width="80%" height="80%">
</a>

```js

const server = require('http').createServer();

server.on('request', (req, res) => {
  res.writeHead(200, { 'content-type': 'text/plain' });
  res.end('Hola, Multiverse(s)!\n');
});

server.listen(8000);

```

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-19.svg" width="80%" height="80%">
</a>

```js
//stanHTTP_2.js
const server = require('http').createServer();

server.on('request', (req, res) => {
  res.writeHead(200, { 'content-type': 'text/plain' });
  res.write('Hola, Multiverse(s)!\n');

setTimeout(function () {
  res.write('Mozart rocks!\n');
  }, 1000);

setTimeout(function () {
  res.write('Beethoven rules!\n');
  }, 1000);
});

server.listen(8000);

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-20.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-21.svg" width="80%" height="80%">
</a>

```js

const fs = require('fs');
const server = require('https')
  .createServer({
  key: fs.readFileSync('./key.pem'), //readFileSync for reading file only once
  cert: fs.readFileSync('./cert.pem'),
});
//use openssl toolkit
server.on('request', (req, res) => {
  res.writeHead(200, { 'content-type': 'text/plain' });
  res.write('Hola, Multiverse(s)!\n');
});

server.listen(443);

//openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -nodes

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-22.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/master/coreNode/10/15-30/svg_files/nodeHTTP.svg" width="60%" height="60%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-23.svg" width="80%" height="80%">
</a>

```js

const http = require('http');

http.request({hostname: 'www.nannerl.io'},
(res) => {
  console.log(res);
});

```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-24.svg" width="80%" height="80%">
</a>

```js
const http = require('http');

const req = http.request(
  { hostname: 'www.nannerl.io'},
(res) => {
  console.log(res);
  }
);

req.on('error', (e) => console.log(e));

req.end();
```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-25.svg" width="80%" height="80%">
</a>

```
$ node stanRequest.js
IncomingMessage {
  _readableState:
   ReadableState {
     objectMode: false,
     highWaterMark: 16384,
     buffer: BufferList { head: null, tail: null, length: 0 },
     length: 0,
     pipes: null,
     pipesCount: 0,
     flowing: null,
     ended: false,
     endEmitted: false,
     reading: false,
     sync: true,
     needReadable: false,
     emittedReadable: false,
     readableListening: false,
     resumeScheduled: false,
     destroyed: false,
     defaultEncoding: 'utf8',
     awaitDrain: 0,
     readingMore: true,
     decoder: null,
     encoding: null },
  readable: true,
  domain: null,
  _events: { end: [Function: responseOnEnd] },
  _eventsCount: 1,
  _maxListeners: undefined,
  socket:
   Socket {
     connecting: false,
     _hadError: false,
     _handle:
      TCP {
        reading: true,
        owner: [Circular],
        onread: [Function: onread],
        onconnection: null,
        writeQueueSize: 0 },
     _parent: null,
     _host: 'www.nannerl.io',
     _readableState:
      ReadableState {
        objectMode: false,
        highWaterMark: 16384,
        buffer: [Object],
        length: 0,
        pipes: null,
        pipesCount: 0,
        flowing: true,
        ended: false,
        endEmitted: false,
        reading: false,
        sync: false,
        needReadable: true,
        emittedReadable: false,
        readableListening: false,
        resumeScheduled: false,
        destroyed: false,
        defaultEncoding: 'utf8',
        awaitDrain: 0,
        readingMore: false,
        decoder: null,
        encoding: null },
     readable: true,
     domain: null,
     _events:
      { end: [Array],
        finish: [Function: onSocketFinish],
        _socketEnd: [Function: onSocketEnd],
        free: [Function: onFree],
        close: [Array],
        agentRemove: [Function: onRemove],
        drain: [Function: ondrain],
        error: [Function: socketErrorListener],
        data: [Function: socketOnData] },
     _eventsCount: 9,
     _maxListeners: undefined,
     _writableState:
      WritableState {
        objectMode: false,
        highWaterMark: 16384,
        finalCalled: false,
        needDrain: false,
        ending: false,
        ended: false,
        finished: false,
        destroyed: false,
        decodeStrings: false,
        defaultEncoding: 'utf8',
        length: 0,
        writing: false,
        corked: 0,
        sync: false,
        bufferProcessing: false,
        onwrite: [Function: bound onwrite],
        writecb: null,
        writelen: 0,
        bufferedRequest: null,
        lastBufferedRequest: null,
        pendingcb: 0,
        prefinished: false,
        errorEmitted: false,
        bufferedRequestCount: 0,
        corkedRequestsFree: [Object] },
     writable: true,
     allowHalfOpen: false,
     _bytesDispatched: 59,
     _sockname: null,
     _pendingData: null,
     _pendingEncoding: '',
     server: null,
     _server: null,
     parser:
      HTTPParser {
        '0': [Function: parserOnHeaders],
        '1': [Function: parserOnHeadersComplete],
        '2': [Function: parserOnBody],
        '3': [Function: parserOnMessageComplete],
        '4': null,
        _headers: [],
        _url: '',
        _consumed: false,
        socket: [Circular],
        incoming: [Circular],
        outgoing: [Object],
        maxHeaderPairs: 2000,
        onIncoming: [Function: parserOnIncomingClient] },
     _httpMessage:
      ClientRequest {
        domain: null,
        _events: [Object],
        _eventsCount: 2,
        _maxListeners: undefined,
        output: [],
        outputEncodings: [],
        outputCallbacks: [],
        outputSize: 0,
        writable: true,
        _last: true,
        upgrading: false,
        chunkedEncoding: false,
        shouldKeepAlive: false,
        useChunkedEncodingByDefault: false,
        sendDate: false,
        _removedConnection: false,
        _removedContLen: false,
        _removedTE: false,
        _contentLength: 0,
        _hasBody: true,
        _trailer: '',
        finished: true,
        _headerSent: true,
        socket: [Circular],
        connection: [Circular],
        _header: 'GET / HTTP/1.1\r\nHost: www.nannerl.io\r\nConnection: close\r\
n\r\n',
        _onPendingData: [Function: noopPendingOutput],
        agent: [Object],
        socketPath: undefined,
        timeout: undefined,
        method: 'GET',
        path: '/',
        _ended: false,
        res: [Circular],
        aborted: undefined,
        timeoutCb: null,
        upgradeOrConnect: false,
        parser: [Object],
        maxHeadersCount: null,
        [Symbol(outHeadersKey)]: [Object] },
     read: [Function],
     _consuming: true,
     [Symbol(asyncId)]: 6,
     [Symbol(bytesRead)]: 0 },
  connection:
   Socket {
     connecting: false,
     _hadError: false,
     _handle:
      TCP {
        reading: true,
        owner: [Circular],
        onread: [Function: onread],
        onconnection: null,
        writeQueueSize: 0 },
     _parent: null,
     _host: 'www.nannerl.io',
     _readableState:
      ReadableState {
        objectMode: false,
        highWaterMark: 16384,
        buffer: [Object],
        length: 0,
        pipes: null,
        pipesCount: 0,
        flowing: true,
        ended: false,
        endEmitted: false,
        reading: false,
        sync: false,
        needReadable: true,
        emittedReadable: false,
        readableListening: false,
        resumeScheduled: false,
        destroyed: false,
        defaultEncoding: 'utf8',
        awaitDrain: 0,
        readingMore: false,
        decoder: null,
        encoding: null },
     readable: true,
     domain: null,
     _events:
      { end: [Array],
        finish: [Function: onSocketFinish],
        _socketEnd: [Function: onSocketEnd],
        free: [Function: onFree],
        close: [Array],
        agentRemove: [Function: onRemove],
        drain: [Function: ondrain],
        error: [Function: socketErrorListener],
        data: [Function: socketOnData] },
     _eventsCount: 9,
     _maxListeners: undefined,
     _writableState:
      WritableState {
        objectMode: false,
        highWaterMark: 16384,
        finalCalled: false,
        needDrain: false,
        ending: false,
        ended: false,
        finished: false,
        destroyed: false,
        decodeStrings: false,
        defaultEncoding: 'utf8',
        length: 0,
        writing: false,
        corked: 0,
        sync: false,
        bufferProcessing: false,
        onwrite: [Function: bound onwrite],
        writecb: null,
        writelen: 0,
        bufferedRequest: null,
        lastBufferedRequest: null,
        pendingcb: 0,
        prefinished: false,
        errorEmitted: false,
        bufferedRequestCount: 0,
        corkedRequestsFree: [Object] },
     writable: true,
     allowHalfOpen: false,
     _bytesDispatched: 59,
     _sockname: null,
     _pendingData: null,
     _pendingEncoding: '',
     server: null,
     _server: null,
     parser:
      HTTPParser {
        '0': [Function: parserOnHeaders],
        '1': [Function: parserOnHeadersComplete],
        '2': [Function: parserOnBody],
        '3': [Function: parserOnMessageComplete],
        '4': null,
        _headers: [],
        _url: '',
        _consumed: false,
        socket: [Circular],
        incoming: [Circular],
        outgoing: [Object],
        maxHeaderPairs: 2000,
        onIncoming: [Function: parserOnIncomingClient] },
     _httpMessage:
      ClientRequest {
        domain: null,
        _events: [Object],
        _eventsCount: 2,
        _maxListeners: undefined,
        output: [],
        outputEncodings: [],
        outputCallbacks: [],
        outputSize: 0,
        writable: true,
        _last: true,
        upgrading: false,
        chunkedEncoding: false,
        shouldKeepAlive: false,
        useChunkedEncodingByDefault: false,
        sendDate: false,
        _removedConnection: false,
        _removedContLen: false,
        _removedTE: false,
        _contentLength: 0,
        _hasBody: true,
        _trailer: '',
        finished: true,
        _headerSent: true,
        socket: [Circular],
        connection: [Circular],
        _header: 'GET / HTTP/1.1\r\nHost: www.nannerl.io\r\nConnection: close\r\
n\r\n',
        _onPendingData: [Function: noopPendingOutput],
        agent: [Object],
        socketPath: undefined,
        timeout: undefined,
        method: 'GET',
        path: '/',
        _ended: false,
        res: [Circular],
        aborted: undefined,
        timeoutCb: null,
        upgradeOrConnect: false,
        parser: [Object],
        maxHeadersCount: null,
        [Symbol(outHeadersKey)]: [Object] },
     read: [Function],
     _consuming: true,
     [Symbol(asyncId)]: 6,
     [Symbol(bytesRead)]: 0 },
  httpVersionMajor: 1,
  httpVersionMinor: 1,
  httpVersion: '1.1',
  complete: false,
  headers:
   { connection: 'close',
     pragma: 'no-cache',
     'cache-control': 'no-cache',
     location: '/kZkLp/' },
  rawHeaders:
   [ 'Connection',
     'close',
     'Pragma',
     'no-cache',
     'cache-control',
     'no-cache',
     'Location',
     '/kZkLp/' ],
  trailers: {},
  rawTrailers: [],
  upgrade: false,
  url: '',
  method: null,
  statusCode: 302,
  statusMessage: 'Found',
  client:
   Socket {
     connecting: false,
     _hadError: false,
     _handle:
      TCP {
        reading: true,
        owner: [Circular],
        onread: [Function: onread],
        onconnection: null,
        writeQueueSize: 0 },
     _parent: null,
     _host: 'www.nannerl.io',
     _readableState:
      ReadableState {
        objectMode: false,
        highWaterMark: 16384,
        buffer: [Object],
        length: 0,
        pipes: null,
        pipesCount: 0,
        flowing: true,
        ended: false,
        endEmitted: false,
        reading: false,
        sync: false,
        needReadable: true,
        emittedReadable: false,
        readableListening: false,
        resumeScheduled: false,
        destroyed: false,
        defaultEncoding: 'utf8',
        awaitDrain: 0,
        readingMore: false,
        decoder: null,
        encoding: null },
     readable: true,
     domain: null,
     _events:
      { end: [Array],
        finish: [Function: onSocketFinish],
        _socketEnd: [Function: onSocketEnd],
        free: [Function: onFree],
        close: [Array],
        agentRemove: [Function: onRemove],
        drain: [Function: ondrain],
        error: [Function: socketErrorListener],
        data: [Function: socketOnData] },
     _eventsCount: 9,
     _maxListeners: undefined,
     _writableState:
      WritableState {
        objectMode: false,
        highWaterMark: 16384,
        finalCalled: false,
        needDrain: false,
        ending: false,
        ended: false,
        finished: false,
        destroyed: false,
        decodeStrings: false,
        defaultEncoding: 'utf8',
        length: 0,
        writing: false,
        corked: 0,
        sync: false,
        bufferProcessing: false,
        onwrite: [Function: bound onwrite],
        writecb: null,
        writelen: 0,
        bufferedRequest: null,
        lastBufferedRequest: null,
        pendingcb: 0,
        prefinished: false,
        errorEmitted: false,
        bufferedRequestCount: 0,
        corkedRequestsFree: [Object] },
     writable: true,
     allowHalfOpen: false,
     _bytesDispatched: 59,
     _sockname: null,
     _pendingData: null,
     _pendingEncoding: '',
     server: null,
     _server: null,
     parser:
      HTTPParser {
        '0': [Function: parserOnHeaders],
        '1': [Function: parserOnHeadersComplete],
        '2': [Function: parserOnBody],
        '3': [Function: parserOnMessageComplete],
        '4': null,
        _headers: [],
        _url: '',
        _consumed: false,
        socket: [Circular],
        incoming: [Circular],
        outgoing: [Object],
        maxHeaderPairs: 2000,
        onIncoming: [Function: parserOnIncomingClient] },
     _httpMessage:
      ClientRequest {
        domain: null,
        _events: [Object],
        _eventsCount: 2,
        _maxListeners: undefined,
        output: [],
        outputEncodings: [],
        outputCallbacks: [],
        outputSize: 0,
        writable: true,
        _last: true,
        upgrading: false,
        chunkedEncoding: false,
        shouldKeepAlive: false,
        useChunkedEncodingByDefault: false,
        sendDate: false,
        _removedConnection: false,
        _removedContLen: false,
        _removedTE: false,
        _contentLength: 0,
        _hasBody: true,
        _trailer: '',
        finished: true,
        _headerSent: true,
        socket: [Circular],
        connection: [Circular],
        _header: 'GET / HTTP/1.1\r\nHost: www.nannerl.io\r\nConnection: close\r\
n\r\n',
        _onPendingData: [Function: noopPendingOutput],
        agent: [Object],
        socketPath: undefined,
        timeout: undefined,
        method: 'GET',
        path: '/',
        _ended: false,
        res: [Circular],
        aborted: undefined,
        timeoutCb: null,
        upgradeOrConnect: false,
        parser: [Object],
        maxHeadersCount: null,
        [Symbol(outHeadersKey)]: [Object] },
     read: [Function],
     _consuming: true,
     [Symbol(asyncId)]: 6,
     [Symbol(bytesRead)]: 0 },
  _consuming: false,
  _dumped: false,
  req:
   ClientRequest {
     domain: null,
     _events: { error: [Function], prefinish: [Function: requestOnPrefinish] },
     _eventsCount: 2,
     _maxListeners: undefined,
     output: [],
     outputEncodings: [],
     outputCallbacks: [],
     outputSize: 0,
     writable: true,
     _last: true,
     upgrading: false,
     chunkedEncoding: false,
     shouldKeepAlive: false,
     useChunkedEncodingByDefault: false,
     sendDate: false,
     _removedConnection: false,
     _removedContLen: false,
     _removedTE: false,
     _contentLength: 0,
     _hasBody: true,
     _trailer: '',
     finished: true,
     _headerSent: true,
     socket:
      Socket {
        connecting: false,
        _hadError: false,
        _handle: [Object],
        _parent: null,
        _host: 'www.nannerl.io',
        _readableState: [Object],
        readable: true,
        domain: null,
        _events: [Object],
        _eventsCount: 9,
        _maxListeners: undefined,
        _writableState: [Object],
        writable: true,
        allowHalfOpen: false,
        _bytesDispatched: 59,
        _sockname: null,
        _pendingData: null,
        _pendingEncoding: '',
        server: null,
        _server: null,
        parser: [Object],
        _httpMessage: [Circular],
        read: [Function],
        _consuming: true,
        [Symbol(asyncId)]: 6,
        [Symbol(bytesRead)]: 0 },
     connection:
      Socket {
        connecting: false,
        _hadError: false,
        _handle: [Object],
        _parent: null,
        _host: 'www.nannerl.io',
        _readableState: [Object],
        readable: true,
        domain: null,
        _events: [Object],
        _eventsCount: 9,
        _maxListeners: undefined,
        _writableState: [Object],
        writable: true,
        allowHalfOpen: false,
        _bytesDispatched: 59,
        _sockname: null,
        _pendingData: null,
        _pendingEncoding: '',
        server: null,
        _server: null,
        parser: [Object],
        _httpMessage: [Circular],
        read: [Function],
        _consuming: true,
        [Symbol(asyncId)]: 6,
        [Symbol(bytesRead)]: 0 },
     _header: 'GET / HTTP/1.1\r\nHost: www.nannerl.io\r\nConnection: close\r\n\r
\n',
     _onPendingData: [Function: noopPendingOutput],
     agent:
      Agent {
        domain: null,
        _events: [Object],
        _eventsCount: 1,
        _maxListeners: undefined,
        defaultPort: 80,
        protocol: 'http:',
        options: [Object],
        requests: {},
        sockets: [Object],
        freeSockets: {},
        keepAliveMsecs: 1000,
        keepAlive: false,
        maxSockets: Infinity,
        maxFreeSockets: 256 },
     socketPath: undefined,
     timeout: undefined,
     method: 'GET',
     path: '/',
     _ended: false,
     res: [Circular],
     aborted: undefined,
     timeoutCb: null,
     upgradeOrConnect: false,
     parser:
      HTTPParser {
        '0': [Function: parserOnHeaders],
        '1': [Function: parserOnHeadersComplete],
        '2': [Function: parserOnBody],
        '3': [Function: parserOnMessageComplete],
        '4': null,
        _headers: [],
        _url: '',
        _consumed: false,
        socket: [Object],
        incoming: [Circular],
        outgoing: [Circular],
        maxHeaderPairs: 2000,
        onIncoming: [Function: parserOnIncomingClient] },
     maxHeadersCount: null,
     [Symbol(outHeadersKey)]: { host: [Array] } } }
```
## Node REPL output for http.globalAgent (used by node to manage sockets ...etc )

```
$ node
> http.globalAgent
Agent {
  domain:
   Domain {
     domain: null,
     _events: { error: [Function: debugDomainError] },
     _eventsCount: 1,
     _maxListeners: undefined,
     members: [] },
  _events: { free: [Function] },
  _eventsCount: 1,
  _maxListeners: undefined,
  defaultPort: 80,
  protocol: 'http:',
  options: { path: null },
  requests: {},
  sockets: {},
  freeSockets: {},
  keepAliveMsecs: 1000,
  keepAlive: false,
  maxSockets: Infinity,
  maxFreeSockets: 256 }
>
```
<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-26.svg" width="80%" height="80%">
</a>

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-27.svg" width="80%" height="80%">
</a>

## Routes in Node

<a>
  <img src="https://github.com/stan-alam/NodeJS/blob/develop/coreNode/10/15-30/svg_files/Notebook-28.svg" width="80%" height="80%">
</a>

```js

const fs = require('fs');
const server = require('http').createServer();

server.on('request', (req, res) => {
  switch (req.url) {
  case '/home':
    res.writeHead(200, { 'Content-Type': 'text/html' });
    res.end(fs.readFileSync('./home.html'));
    break;
  case '/':

    break;
  default:

  }
});

server.listen(8000);

```
$ curl localhost:8000/home
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   289    0   289    0     0   2627      0 --:--:-- --:--:-- --:--:--  3074<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset ="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale-1.0">
  <met http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Nannerl.io</title>
</head>
<body>
  Welcome to Nannerl.io
</body>
</html>

```
